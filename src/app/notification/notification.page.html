<ion-content class="ion-padding">
  <div class="page-container">
    
    <!-- Header -->
    <div class="welcome-header">
      <h1 class="page-title">Notifications</h1>
      <div class="header-actions">
        <ion-button *ngIf="unreadCount > 0" fill="clear" size="small" (click)="markAllAsRead()">
          <ion-icon name="checkmark-done-outline" slot="start"></ion-icon>
          Tout marquer comme lu
        </ion-button>
      </div>
    </div>

    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-container">
      <ion-spinner name="crescent"></ion-spinner>
      <p>Chargement des notifications...</p>
    </div>

    <!-- Error State -->
    <div *ngIf="errorMessage" class="error-message">
      <ion-icon name="warning-outline"></ion-icon>
      <p>{{errorMessage}}</p>
      <ion-button fill="clear" (click)="loadNotifications()">RÃ©essayer</ion-button>
    </div>

    <!-- Main Content -->
    <div *ngIf="!isLoading && !errorMessage">
      
      <!-- Badge non lus -->
      <div *ngIf="unreadCount > 0" class="unread-badge">
        <ion-badge color="danger">{{unreadCount}} non lu{{unreadCount > 1 ? 's' : ''}}</ion-badge>
      </div>

      <!-- Liste des notifications -->
      <div *ngIf="notifications.length > 0; else noNotifications">
        <ion-list class="notifications-list">
          
          <ion-item-sliding *ngFor="let notification of notifications">
            
            <!-- Notification item -->
            <ion-item 
              [class.unread]="!notification.vue" 
              (click)="openNotification(notification)"
              detail="true"
            >
              <div class="notification-content" slot="start">
                
                <!-- Icon selon type -->
                <div class="notification-icon" [class]="getNotificationTypeClass(notification.type)">
                  <ion-icon [name]="getNotificationIcon(notification.type)"></ion-icon>
                </div>
                
                <!-- Contenu -->
                <div class="notification-details">
                  <div class="notification-header">
                    <h3 class="notification-title">{{notification.titre}}</h3>
                    <span *ngIf="!notification.vue" class="unread-dot"></span>
                  </div>
                  <p class="notification-body">{{notification.texte}}</p>
                  
                  <div class="notification-meta">
                    <span class="notification-date">
                      <ion-icon name="time-outline"></ion-icon>
                      {{formatDate(notification.dateHeure)}}
                    </span>
                    <span class="notification-type" *ngIf="notification.type">
                      {{getNotificationTypeLabel(notification.type)}}
                    </span>
                  </div>
                </div>
              </div>
            </ion-item>

            <!-- Options slide -->
            <ion-item-options side="end">
              <ion-item-option 
                *ngIf="!notification.vue"
                color="primary" 
                (click)="markAsRead(notification.id)"
              >
                <ion-icon slot="icon-only" name="checkmark-outline"></ion-icon>
                Marquer lu
              </ion-item-option>
              
              <ion-item-option 
                color="danger" 
                (click)="deleteNotification(notification.id)"
              >
                <ion-icon slot="icon-only" name="trash-outline"></ion-icon>
                Supprimer
              </ion-item-option>
            </ion-item-options>
          </ion-item-sliding>
        </ion-list>

        <!-- Pagination ou fin -->
        <div class="list-footer">
          <p *ngIf="notifications.length >= 50" class="load-more" (click)="loadMore()">
            Charger plus de notifications...
          </p>
          <p *ngIf="notifications.length < 50" class="end-of-list">
            {{notifications.length}} notification{{notifications.length > 1 ? 's' : ''}}
          </p>
        </div>
      </div>

      <!-- Aucune notification -->
      <ng-template #noNotifications>
        <div class="empty-state">
          <ion-icon name="notifications-off-outline"></ion-icon>
          <h3>Aucune notification</h3>
          <p>Vous n'avez pas encore de notifications</p>
        </div>
      </ng-template>

    </div>
  </div>
</ion-content>