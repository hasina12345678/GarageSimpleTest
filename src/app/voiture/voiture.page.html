<ion-content class="ion-padding">
  <!-- <h1>Mes Voitures</h1>
  <p class="subtitle">Ajoutez et supprimer vos voitures ici</p> -->

  <div class="welcome-header">
    <h1 class="page-title">Mes Voitures</h1>
    <p class="subtitle">Vue d'ensemble de votre garage</p>
  </div>

  <!-- Formulaire d'ajout de voiture -->
  <ion-card class="ion-margin-bottom">
    <ion-card-header>
      <ion-card-title>Ajoutez / supprimer vos voitures.</ion-card-title>
    </ion-card-header>
    
    <ion-card-content>
      <form [formGroup]="voitureForm" (ngSubmit)="ajouterVoiture()">
        <!-- Matricule -->
        <ion-item>
          <ion-label position="floating">Matricule*</ion-label>
          <ion-input 
            formControlName="matricule" 
            type="text" 
            placeholder="Ex: AB-123-CD"
          ></ion-input>
        </ion-item>
        <ion-note color="danger" *ngIf="voitureForm.get('matricule')?.invalid && voitureForm.get('matricule')?.touched">
          Le matricule est requis
        </ion-note>

        <!-- Marque -->
        <ion-item>
          <ion-label position="floating">Marque</ion-label>
          <ion-input 
            formControlName="marque" 
            type="text" 
            placeholder="Ex: Toyota"
          ></ion-input>
        </ion-item>

        <!-- Modèle -->
        <ion-item>
          <ion-label position="floating">Modèle</ion-label>
          <ion-input 
            formControlName="modele" 
            type="text" 
            placeholder="Ex: Corolla"
          ></ion-input>
        </ion-item>

        <!-- Année -->
        <ion-item>
          <ion-label position="floating">Année</ion-label>
          <ion-input 
            formControlName="annee" 
            type="number" 
            placeholder="Ex: 2020"
            min="1900"
            max="{{currentYear}}"
          ></ion-input>
        </ion-item>

        <!-- Bouton de soumission -->
        <ion-button 
          expand="block" 
          type="submit" 
          class="ion-margin-top"
          [disabled]="!voitureForm.valid || isLoading"
        >
          <ion-spinner *ngIf="isLoading" name="crescent"></ion-spinner>
          <span *ngIf="!isLoading">Ajouter la voiture</span>
        </ion-button>
      </form>
    </ion-card-content>
  </ion-card>

  <!-- Liste des voitures -->
  <div *ngIf="voitures.length > 0; else pasDeVoitures">
    <h2>Listes ({{voitures.length}})</h2>
    <p style="color: #292E4C;">Glisser vers le gauche <strong style="font-weight: bolder; font-size: larger;"> << </strong>  pour supprimer. </p>
    
    <ion-list>
      <ion-item-sliding *ngFor="let voiture of voitures">
        <ion-item>
          <ion-label>
            <h2>{{voiture.marque || 'Marque non spécifiée'}} {{voiture.modele || ''}}</h2>
            <p>
              <strong>Matricule:</strong> {{voiture.matricule}}<br>
              <strong>Année:</strong> {{voiture.annee || 'Non spécifiée'}}<br>
              <strong>Année:</strong> {{voiture.annee || 'Non spécifiée'}}<br>
              <!-- CORRECTION ICI : Utilisez la méthode formatDate au lieu du pipe date -->
              <strong>Ajoutée le:</strong> {{formatDate(voiture.dateAjout)}}
            </p>
          </ion-label>
          <ion-badge slot="end" color="primary">
            {{voiture.marque ? voiture.marque.substring(0, 1) : 'V'}}
          </ion-badge>
        </ion-item>

        <ion-item-options side="end">
          <ion-item-option color="danger" (click)="supprimerVoiture(voiture.id!)">
            <ion-icon name="trash" slot="icon-only"></ion-icon>
          </ion-item-option>
        </ion-item-options>
      </ion-item-sliding>
    </ion-list>
  </div>

  <!-- Message si pas de voitures -->
  <ng-template #pasDeVoitures>
    <ion-card>
      <ion-card-content class="ion-text-center">
        <ion-icon name="car-outline" style="font-size: 64px; color: var(--ion-color-medium);"></ion-icon>
        <h2>Aucune voiture enregistrée</h2>
        <p>Ajoutez votre première voiture en utilisant le formulaire ci-dessus.</p>
      </ion-card-content>
    </ion-card>
  </ng-template>
</ion-content>